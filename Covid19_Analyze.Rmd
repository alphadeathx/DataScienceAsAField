---
title: "Covid19_Analyze"
output: pdf_document
date: "2025-04-12"
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)
library(patchwork)

base_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"
file_names <- c("time_series_covid19_confirmed_global.csv",
                "time_series_covid19_deaths_global.csv",
                "time_series_covid19_confirmed_US.csv",
                "time_series_covid19_deaths_US.csv")

urls <- str_c(base_url, file_names)

global_cases <- read_csv(urls[1])
global_deaths <- read_csv(urls[2])
US_cases <- read_csv(urls[3])
US_deaths <- read_csv(urls[4])

```


```{r tidy_global_data, include=FALSE}
global_cases <- global_cases %>%
  pivot_longer(cols = -c(`Province/State`, 
                         `Country/Region`, Lat, Long), 
               names_to = "date",
               values_to = "cases") %>%
  select(-c(Lat,Long))

global_deaths <- global_deaths %>%
  pivot_longer(cols = -c(`Province/State`, 
                         `Country/Region`, Lat, Long), 
               names_to = "date",
               values_to = "deaths") %>%
  select(-c(Lat,Long))

global <- global_cases %>%
  full_join(global_deaths) %>%
  rename(`Province_State` = `Province/State`,
         `Country_Region` = `Country/Region`,) %>% 
  mutate(date = mdy(date))

##summary(global)
global <- global %>% filter(cases > 0)
global %>% filter(cases > 103000000)
```


```{r include=FALSE}
US_cases %>%
  pivot_longer(cols = -(UID:Combined_Key),
               names_to = "date",
               values_to = "cases")

US_cases <- US_cases %>%
  pivot_longer(cols = -(UID:Combined_Key),
               names_to = "date",
               values_to = "cases") %>%
  select(Admin2:cases) %>%
  mutate(date = mdy(date)) %>%
  select( -c(Lat, Long_))

```


```{r include=TRUE}
US_deaths %>%
  pivot_longer(cols = -(UID:Population),
               names_to = "date",
               values_to = "deaths")

US_deaths <- US_deaths %>%
  pivot_longer(cols = -(UID:Population),
               names_to = "date",
               values_to = "deaths") %>%
  select(Admin2:deaths) %>%
  mutate(date = mdy(date)) %>%
  select(-c(Lat, Long_))

```


```{r include=FALSE}
global <- global %>%
  unite("Combined_Key",
        c(Province_State, Country_Region),
        sep = ", ",
        na.rm = TRUE,
        remove = FALSE)

```


```{r include=FALSE}
uid_lookup_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv"

uid <- read_csv(uid_lookup_url) %>%
  select( -c(Lat, Long_, Combined_Key, code3, iso2, iso3, Admin2))

global <- global %>%
  left_join(uid, by = c("Province_State",  "Country_Region")) %>%
  select(-c(UID, FIPS)) %>%
  select(Province_State, Country_Region, date, cases, deaths, Population, Combined_Key)

```


```{r echo=FALSE}

# Time Series Plot
plot1 <- ggplot(global, aes(x = date, y = deaths, color = "Global")) +
  geom_line() +
  geom_line(data = US_deaths, aes(x = date, y = deaths, color = "US")) +
  
  labs(title = "COVID-19 Deaths Over Time", x = "Date", y = "Cumulative Deaths", color = "Region") +
  scale_y_continuous(labels = scales::comma)+
  
  scale_color_manual(values = c("Global" = "blue", "US" = "red")) +
  theme_bw()

combined_plot <- plot1 + plot_layout(ncol = 1)
ggsave("covid_1.png", combined_plot, width = 7, height = 9, units = "in")
  knitr::include_graphics("covid_1.png")
```



```{r echo=FALSE}

US_data <- US_cases %>%
  inner_join(US_deaths, by = c("Admin2", "Province_State", "Country_Region", "date")) %>%
  group_by(Country_Region) %>%
  arrange(date) %>%
  mutate(cum_cases = cumsum(cases), cum_deaths = cumsum(deaths))

# US data
plot2 <- ggplot(US_data, aes(x = cum_cases, y = cum_deaths)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", linewidth = 3)+ 
  labs(title = "US: Cumulative Cases vs. Cumulative Deaths", x = "Cumulative Cases", y = "Cumulative Deaths") +
  scale_x_continuous( labels = scales::comma)+
  scale_y_continuous( labels = scales::comma)+
    
  theme_bw()

combined_plot <- plot2 + plot_layout(ncol = 1)
ggsave("covid_2.png", combined_plot, width = 7, height = 9, units = "in")
  knitr::include_graphics("covid_2.png")

```